<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ…¢é€’ - è§å­—å¦‚é¢</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --theme: #7a6e5d; --bg: #f8f5f0; }
        body { margin: 0; background: var(--bg); font-family: "PingFang SC", "Microsoft YaHei", serif; color: #444; }
        #app { max-width: 500px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .nav { display: flex; justify-content: space-around; padding: 20px 0; background: #fff; border-bottom: 1px solid #eee; }
        .nav-item { cursor: pointer; color: #999; padding-bottom: 5px; }
        .nav-item.active { color: var(--theme); border-bottom: 2px solid var(--theme); font-weight: bold; }

        /* å†…å®¹åŒº */
        .content { flex: 1; padding: 20px; }
        
        /* å†™ä¿¡é¡µ */
        .editor-card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        textarea { width: 100%; height: 200px; border: none; outline: none; font-size: 16px; line-height: 1.6; resize: none; background: url('https://lucide.dev/api/patterns/lines') repeat; }
        .timer-select { margin-top: 20px; border-top: 1px dashed #ddd; padding-top: 15px; }
        button { width: 100%; background: var(--theme); color: white; border: none; padding: 12px; border-radius: 25px; font-size: 16px; margin-top: 20px; }

        /* ä¿¡ç®±é¡µ */
        .letter-item { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--theme); }
        .status-tag { font-size: 12px; color: #999; background: #eee; padding: 2px 8px; border-radius: 10px; }
        .arrival-content { font-style: italic; color: #222; margin-top: 10px; }
    </style>
</head>
<body>

<div id="app">
    <div class="nav">
        <div class="nav-item" :class="{active: tab==='write'}" @click="tab='write'">å¯„ä¿¡</div>
        <div class="nav-item" :class="{active: tab==='box'}" @click="tab='box'">ä¿¡ç®± ({{letters.length}})</div>
    </div>

    <div class="content">
        <div v-if="tab==='write'" class="editor-card">
            <textarea v-model="newMsg" placeholder="æ­¤æ—¶æ­¤åˆ»ï¼Œæƒ³å¯¹ä»–è¯´äº›ä»€ä¹ˆ..."></textarea>
            <div class="timer-select">
                <span>è®¾å®šå¯„è¾¾æ—¶é—´ï¼š</span>
                <select v-model="delay">
                    <option value="10000">10ç§’ (æµ‹è¯•)</option>
                    <option value="60000">1åˆ†é’Ÿ</option>
                    <option value="3600000">1å°æ—¶</option>
                    <option value="86400000">24å°æ—¶</option>
                </select>
            </div>
            <button @click="sendLetter">å¯†å°å¹¶æŠ•é€’</button>
        </div>

        <div v-if="tab==='box'">
            <div v-if="letters.length === 0" style="text-align: center; color: #ccc; margin-top: 50px;">æš‚æ— å¾€æ¥ä¿¡ä»¶</div>
            <div v-for="(l, index) in letters" :key="index" class="letter-item">
                <div>
                    <span class="status-tag">{{ getStatus(l) }}</span>
                    <small style="float:right; color:#999">{{ formatTime(l.sendAt) }}</small>
                </div>
                <div v-if="isArrived(l)" class="arrival-content">{{ l.content }}</div>
                <div v-else style="color:#999; margin-top:10px; font-size:14px;">
                    é‚®å·®æ­£åœ¨è·¯é€”ä¸­... é¢„è®¡ {{ formatTime(l.arriveAt) }} é€è¾¾
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
        setup() {
            const tab = ref('write');
            const newMsg = ref('');
            const delay = ref('10000');
            const letters = ref(JSON.parse(localStorage.getItem('my_letters') || '[]'));

            const sendLetter = () => {
                if(!newMsg.value) return alert("ä¿¡çº¸è¿˜æ˜¯ç©ºçš„");
                const letter = {
                    content: newMsg.value,
                    sendAt: Date.now(),
                    arriveAt: Date.now() + parseInt(delay.value)
                };
                letters.value.unshift(letter);
                localStorage.setItem('my_letters', JSON.stringify(letters.value));
                newMsg.value = '';
                tab.value = 'box';
            };

            const isArrived = (l) => Date.now() >= l.arriveAt;
            const getStatus = (l) => isArrived(l) ? 'âœ… å·²é€è¾¾' : 'ğŸšš é…é€ä¸­';
            const formatTime = (ts) => new Date(ts).toLocaleString();

            // æ¯ç§’åˆ·æ–°ä¸€æ¬¡çŠ¶æ€
            onMounted(() => {
                setInterval(() => {}, 1000); 
            });

            return { tab, newMsg, delay, letters, sendLetter, isArrived, getStatus, formatTime };
        }
    }).mount('#app');
</script>

</body>
</html>
